<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
            background-color: #0e0e0e;
            color: #eaeaea;
        }

        .container {
            padding: 16px;
        }

        h1 {
            margin-bottom: 16px;
        }

        /* ===== TABS ===== */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            height: 44px;
            background: #1c1c1c;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 600;
            transition: 0.2s;
            user-select: none;
        }

        .tab:hover {
            background: #262626;
        }

        .tab.active {
            background: #2a82f5;
            color: #fff;
        }

        .badge {
            background: rgba(255,255,255,0.2);
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 6px;
        }

        /* ===== SECTIONS ===== */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* ===== CARDS ===== */
        .card {
            background: #1c1c1c;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .muted {
            color: #9e9e9e;
            font-size: 13px;
        }

        pre {
            white-space: pre-wrap;
            font-size: 13px;
            margin: 0;
        }

        /* ===== SEARCH ===== */
        .search {
            width: 100%;
            padding: 12px;
            margin-bottom: 12px;
            background: #1c1c1c;
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            outline: none;
        }
    </style>
</head>

<body>
<div class="container">

    <h1>üìä –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>

    <!-- TABS -->
    <div class="tabs">
        <div class="tab active" onclick="showTab('users', this)">üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
        <div class="tab" onclick="showTab('cookies', this)">



            <div id="cookies-section">
    <h2>Cookies</h2>
    <div id="cookies-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<script>
async function loadCookies() {
    const res = await fetch("/admin/get_cookies");
    const data = await res.json();

    const box = document.getElementById("cookies-list");
    box.innerHTML = "";

    if (data.cookies.length === 0) {
        box.innerHTML = "<p>–ö—É–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>";
        return;
    }

    data.cookies.forEach(file => {
        const row = document.createElement("div");
        row.className = "cookie-row";

        row.innerHTML = `
            <span>${file}</span>
            <button onclick="deleteCookie('${file}')" class="del-btn">–£–¥–∞–ª–∏—Ç—å</button>
        `;

        box.appendChild(row);
    });
}

async function deleteCookie(filename) {
    if (!confirm(`–£–¥–∞–ª–∏—Ç—å ${filename}?`)) return;

    const res = await fetch(`/admin/delete_cookie?filename=${filename}`, {
        method: "DELETE"
    });

    const data = await res.json();

    if (data.status === "ok") {
        alert(`–£–¥–∞–ª–µ–Ω–æ: ${data.deleted}`);
        loadCookies(); // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
    }
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∫—É–∫–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
loadCookies();
</script>

<style>
.cookie-row {
    display: flex;
    justify-content: space-between;
    background: #1f1f1f;
    padding: 10px;
    margin: 5px 0;
    border-radius: 8px;
}

.del-btn {
    background: #ff4444;
    border: none;
    padding: 6px 12px;
    color: white;
    border-radius: 6px;
    cursor: pointer;
}
</style>

            üç™ Cookies <span class="badge">{{ cookies_count }}</span>
        </div>
        <div class="tab" onclick="showTab('logs', this)">üßæ –õ–æ–≥–∏</div>
    </div>

    <!-- USERS -->
    <div id="users" class="section active">
        {% for u in users %}
        <div class="card">
            <b>{{ u[1] }}</b>
            <div class="muted">TG ID: {{ u[0] }}</div>
            –ë–∞–ª–∞–Ω—Å: {{ u[2] }} USDT
        </div>
        {% else %}
        <div class="muted">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        {% endfor %}
    </div>

    <!-- COOKIES -->
    <div id="cookies" class="section">
        {% for c in cookies %}
        <div class="card">üç™ {{ c }}</div>
        {% else %}
        <div class="muted">Cookies –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</div>
        {% endfor %}
    </div>

    <!-- LOGS -->
    <div id="logs" class="section">

        <input
            type="text"
            class="search"
            placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ UID (–Ω–∞–ø—Ä–∏–º–µ—Ä U-30CF99)"
            oninput="filterLogs(this.value)"
        >

        <div id="logsList">
            {% for line in logs %}
            <div class="card log-line">
                <pre>{{ line }}</pre>
            </div>
            {% else %}
            <div class="muted">–õ–æ–≥–∏ –ø—É—Å—Ç—ã</div>
            {% endfor %}
        </div>

    </div>

</div>

<script>
    function showTab(name, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

        document.getElementById(name).classList.add('active');
        el.classList.add('active');
    }

    function filterLogs(value) {
        value = value.toUpperCase();
        document.querySelectorAll('.log-line').forEach(el => {
            el.style.display = el.innerText.toUpperCase().includes(value)
                ? 'block'
                : 'none';
        });
    }
</script>
<script>
    const tg = window.Telegram.WebApp;
    tg.ready();

    const user = tg.initDataUnsafe.user;

    if (!user) {
        document.body.innerHTML = "‚ùå Telegram user not found";
    } else {
        const url = new URL(window.location.href);
        if (!url.searchParams.get("tg_id")) {
            url.searchParams.set("tg_id", user.id);
            window.location.replace(url.toString());
        }
    }
</script>

</body>
</html>
